<!DOCTYPE html>
<html lang="id">
<head>
Â    <meta charset="UTF-8">
Â    <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â    <title>Dashboard Analisis Agroindustri Kelapa Sawit ğŸŒ³</title>
Â    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
Â    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
Â    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
Â    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

Â    <style>
Â        /* ğŸ¨ CSS Khusus untuk Nuansa Kelapa Sawit (Hijau & Coklat) */
Â        :root {
Â            --palm-green-dark: #004d40; /* Hijau Tua/Emerald */
Â            --palm-green-light: #4caf50; /* Hijau Sedang */
Â            --palm-accent: #a5d6a7; /* Hijau Muda/Aksen */
Â            --text-color: #333;
Â            --bg-light: #f4f7f6;
Â        }

Â        body {
Â            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â            margin: 0;
Â            padding: 0;
Â            background-color: var(--bg-light);
Â            color: var(--text-color);
Â        }

Â        .header {
Â            background-color: var(--palm-green-dark);
Â            color: white;
Â            padding: 20px;
Â            text-align: center;
Â            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â        }

Â        .header h1 {
Â            margin: 0;
Â            font-size: 2em;
Â        }

Â        .container {
Â            padding: 20px;
Â            max-width: 1400px;
Â            margin: 0 auto;
Â        }

Â        .kpi-cards {
Â            display: flex;
Â            gap: 20px;
Â            margin-bottom: 30px;
Â            flex-wrap: wrap;
Â        }

Â        .kpi-card {
Â            flex: 1;
Â            min-width: 200px;
Â            background-color: white;
Â            padding: 20px;
Â            border-radius: 8px;
Â            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
Â            border-left: 5px solid var(--palm-green-light);
Â            transition: transform 0.3s;
Â        }
Â 
Â        .kpi-card:hover {
Â            transform: translateY(-5px);
Â        }

Â        .kpi-card .value {
Â            font-size: 2.5em;
Â            font-weight: bold;
Â            color: var(--palm-green-dark);
Â        }

Â        .kpi-card .label {
Â            font-size: 0.9em;
Â            color: #666;
Â            margin-top: 5px;
Â        }

Â        .chart-grid {
Â            display: grid;
Â            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
Â            gap: 20px;
Â            margin-bottom: 30px;
Â        }

Â        .chart-container {
Â            background-color: white;
Â            padding: 20px;
Â            border-radius: 8px;
Â            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
Â            min-height: 350px;
Â        }

Â        .table-container {
Â            background-color: white;
Â            padding: 20px;
Â            border-radius: 8px;
Â            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
Â        }

Â        /* Styling untuk DataTables */
Â        #dataTabel_wrapper .dataTables_filter input,
Â        #dataTabel_wrapper .dataTables_length select {
Â            border: 1px solid var(--palm-accent);
Â            padding: 5px;
Â            border-radius: 4px;
Â        }
Â        table.dataTable thead th {
Â            background-color: var(--palm-green-light);
Â            color: white;
Â        }

Â        .controls {
Â            display: flex;
Â            justify-content: space-between;
Â            align-items: center;
Â            margin-bottom: 20px;
Â        }

Â        .btn-download {
Â            background-color: var(--palm-green-light);
Â            color: white;
Â            border: none;
Â            padding: 10px 15px;
Â            border-radius: 5px;
Â            cursor: pointer;
Â            transition: background-color 0.3s;
Â            font-weight: bold;
Â        }

Â        .btn-download:hover {
Â            background-color: var(--palm-green-dark);
Â        }
Â    </style>
</head>
<body>

Â    <div class="header">
Â        <h1>ğŸŒ³ Dashboard Analisis Operasi Kelapa Sawit ğŸ“ˆ</h1>
Â        <p>Aplikasi Interaktif untuk Manajer dan Teknisi Pabrik</p>
Â    </div>

Â    <div class="container">
Â        <div class="controls">
Â            <div>
Â                <label for="filterBulan">Filter Bulan/Tahun:</label>
Â                <select id="filterBulan" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
Â                    <option value="Semua">Semua Data</option>
Â                    <option value="Jan-2024">Januari 2024</option>
Â                    <option value="Feb-2024">Februari 2024</option>
Â                    <option value="Mar-2024">Maret 2024</option>
Â                </select>
Â            </div>
Â            <button class="btn-download" onclick="unduhData()">â¬‡ï¸ Unduh Data (CSV)</button>
Â        </div>

Â        <h2>ğŸ”¬ Metrik Kunci Kinerja (KPI)</h2>
Â        <div class="kpi-cards">
Â            <div class="kpi-card">
Â                <div class="value" id="kpiTotalProduksi">0</div>
Â                <div class="label">Total Produksi TBS (Ton)</div>
Â            </div>
Â            <div class="kpi-card">
Â                <div class="value" id="kpiRataHarga">Rp 0</div>
Â                <div class="label">Rata-rata Harga Jual (Rp/Kg)</div>
Â            </div>
Â            <div class="kpi-card">
Â                <div class="value" id="kpiTotalArea">200 Ha</div>
Â                <div class="label">Total Area Kebun</div>
Â            </div>
Â            <div class="kpi-card">
Â                <div class="value" id="kpiYield">0 Ton/Ha</div>
Â                <div class="label">Rata-rata Yield (TBS)</div>
Â            </div>
Â        </div>

Â        <h2>ğŸ“Š Visualisasi Data Interaktif</h2>
Â        <div class="chart-grid">
Â            <div class="chart-container">
Â                <h3>Produksi TBS Bulanan (Ton)</h3>
Â                <canvas id="chartProduksi"></canvas>
Â            </div>
Â            <div class="chart-container">
Â                <h3>Fluktuasi Harga Jual CPO (Rp/Kg)</h3>
Â                <canvas id="chartHarga"></canvas>
Â            </div>
Â            <div class="chart-container">
Â                <h3>Distribusi Penjualan Berdasarkan Produk (%)</h3>
Â                <canvas id="chartPenjualanPie"></canvas>
Â            </div>
Â            <div class="chart-container">
Â                <h3>Rendemen (OER) per Periode</h3>
Â                <canvas id="chartRendemen"></canvas>
Â            </div>
Â        </div>

Â        <h2>ğŸ“‹ Data Operasional Detail</h2>
Â        <div class="table-container">
Â            <table id="dataTabel" class="display" style="width:100%">
Â                <thead>
Â                    <tr>
Â                        <th>Periode</th>
Â                        <th>Blok/Area (Ha)</th>
Â                        <th>Produksi TBS (Ton)</th>
Â                        <th>Penjualan CPO (Kg)</th>
Â                        <th>Harga CPO (Rp/Kg)</th>
Â                        <th>Rendemen (OER)</th>
Â                    </tr>
Â                </thead>
Â                <tbody>
Â                    </tbody>
Â            </table>
Â        </div>

Â    </div>

Â    <script>
Â        // ğŸ’¾ Data Mentah (Simulasi data yang diekstrak dari file yang diunggah)
Â        const rawData = [
Â            { periode: "Jan-2024", blok: "A1", area: 50, tbs: 1000, cpoJual: 200000, hargaCPO: 12500, oer: 0.20 },
Â            { periode: "Jan-2024", blok: "B2", area: 50, tbs: 1200, cpoJual: 240000, hargaCPO: 12450, oer: 0.20 },
Â            { periode: "Feb-2024", blok: "A1", area: 50, tbs: 1100, cpoJual: 210000, hargaCPO: 13000, oer: 0.19 },
Â            { periode: "Feb-2024", blok: "B2", area: 50, tbs: 1300, cpoJual: 270000, hargaCPO: 13100, oer: 0.21 },
Â            { periode: "Mar-2024", blok: "A1", area: 50, tbs: 1500, cpoJual: 300000, hargaCPO: 13500, oer: 0.20 },
Â            { periode: "Mar-2024", blok: "B2", area: 50, tbs: 1400, cpoJual: 290000, hargaCPO: 13400, oer: 0.21 },
Â            // Total area: 6 * 50 = 300 Ha (Contoh, bisa disesuaikan ke 200 Ha)
Â            { periode: "Jan-2024", blok: "C3", area: 50, tbs: 900, cpoJual: 180000, hargaCPO: 12400, oer: 0.20 },
Â            { periode: "Feb-2024", blok: "C3", area: 50, tbs: 1050, cpoJual: 200000, hargaCPO: 13050, oer: 0.19 },
Â            { periode: "Mar-2024", blok: "C3", area: 50, tbs: 1200, cpoJual: 250000, hargaCPO: 13300, oer: 0.21 },
Â        ];

Â        let currentData = rawData;
Â        let dataTable;

Â        // ğŸ“Š Fungsi untuk Menginisialisasi Grafik
Â        function initCharts(data) {
Â            const aggregated = data.reduce((acc, item) => {
Â                acc[item.periode] = acc[item.periode] || { tbs: 0, cpoJual: 0, hargaTotal: 0, count: 0, oerTotal: 0, area: 0 };
Â                acc[item.periode].tbs += item.tbs;
Â                acc[item.periode].cpoJual += item.cpoJual;
Â                acc[item.periode].hargaTotal += item.hargaCPO;
Â                acc[item.periode].count += 1;
Â                acc[item.periode].oerTotal += item.oer;
Â                acc[item.periode].area += item.area;
Â                return acc;
Â            }, {});

Â            const labels = Object.keys(aggregated).sort();
Â            const tbsData = labels.map(key => aggregated[key].tbs);
Â            const hargaData = labels.map(key => (aggregated[key].hargaTotal / aggregated[key].count).toFixed(0));
Â            const oerData = labels.map(key => (aggregated[key].oerTotal / aggregated[key].count).toFixed(2));
Â 
Â            // --- Grafik 1: Produksi TBS (Batang) ---
Â            new Chart(document.getElementById('chartProduksi'), {
Â                type: 'bar',
Â                data: {
Â                    labels: labels,
Â                    datasets: [{
Â                        label: 'Produksi TBS (Ton)',
Â                        data: tbsData,
Â                        backgroundColor: var(--palm-green-light),
Â                        borderColor: var(--palm-green-dark),
Â                        borderWidth: 1
Â                    }]
Â                },
Â                options: { responsive: true, scales: { y: { beginAtZero: true } } }
Â            });

Â            // --- Grafik 2: Harga Jual CPO (Garis) ---
Â            new Chart(document.getElementById('chartHarga'), {
Â                type: 'line',
Â                data: {
Â                    labels: labels,
Â                    datasets: [{
Â                        label: 'Harga CPO Rata-rata (Rp/Kg)',
Â                        data: hargaData,
Â                        fill: false,
Â                        borderColor: '#ff9800', /* Aksen Oranye untuk Harga */
Â                        tension: 0.1
Â                    }]
Â                },
Â                options: { responsive: true, scales: { y: { beginAtZero: false } } }
Â            });
Â 
Â            // --- Grafik 3: Distribusi Penjualan (Lingkaran) ---
Â            // Asumsi produk: CPO dan PKO
Â            const totalCPO = data.reduce((sum, item) => sum + item.cpoJual, 0);
Â            const totalPKO = totalCPO * 0.05; // Estimasi PKO 5% dari CPO (simulasi)
Â            new Chart(document.getElementById('chartPenjualanPie'), {
Â                type: 'pie',
Â                data: {
Â                    labels: ['Minyak Sawit Mentah (CPO)', 'Minyak Inti Sawit (PKO)'],
Â                    datasets: [{
Â                        data: [totalCPO, totalPKO],
Â                        backgroundColor: [
Â                            var(--palm-green-light),
Â                            '#8d6e63' /* Coklat untuk PKO */
Â                        ],
Â                        hoverOffset: 4
Â                    }]
Â                },
Â                options: { responsive: true }
Â            });

Â            // --- Grafik 4: Rendemen OER (Batang) ---
Â            new Chart(document.getElementById('chartRendemen'), {
Â                type: 'bar',
Â                data: {
Â                    labels: labels,
Â                    datasets: [{
Â                        label: 'Rendemen (OER) Rata-rata',
Â                        data: oerData,
Â                        backgroundColor: var(--palm-accent),
Â                        borderColor: var(--palm-green-dark),
Â                        borderWidth: 1
Â                    }]
Â                },
Â                options: { responsive: true, scales: { y: { beginAtZero: true, max: 0.3 } } }
Â            });

Â        }

Â        // ğŸ“ˆ Fungsi untuk Memperbarui KPI
Â        function updateKPIs(data) {
Â            const totalTbs = data.reduce((sum, item) => sum + item.tbs, 0);
Â            const totalArea = data.reduce((sum, item) => item.area, 0); // Asumsi total area tetap 200 Ha (atau total dari semua blok yang terfilter)
Â            const totalHarga = data.reduce((sum, item) => sum + item.hargaCPO, 0);
Â            const count = data.length;

Â            const avgHarga = count > 0 ? (totalHarga / count) : 0;
Â            const avgYield = totalArea > 0 ? (totalTbs / totalArea).toFixed(2) : 0;

Â            document.getElementById('kpiTotalProduksi').innerText = totalTbs.toLocaleString('id-ID');
Â            document.getElementById('kpiRataHarga').innerText = 'Rp ' + avgHarga.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
Â            document.getElementById('kpiTotalArea').innerText = totalArea.toLocaleString('id-ID') + ' Ha';
Â            document.getElementById('kpiYield').innerText = avgYield.toLocaleString('id-ID') + ' Ton/Ha';
Â        }

Â        // <table> Fungsi untuk Mengisi dan Menginisialisasi DataTables
Â        function initDataTable(data) {
Â            // Hapus tabel lama jika sudah ada
Â            if (dataTable) {
Â                dataTable.destroy();
Â                $('#dataTabel tbody').empty();
Â            }

Â            const tableData = data.map(item => [
Â                item.periode,
Â                item.area + ' Ha (' + item.blok + ')',
Â                item.tbs.toLocaleString('id-ID'),
Â                item.cpoJual.toLocaleString('id-ID'),
Â                'Rp ' + item.hargaCPO.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 }),
Â                (item.oer * 100).toFixed(1) + '%'
Â            ]);

Â            dataTable = $('#dataTabel').DataTable({
Â                data: tableData,
Â                responsive: true,
Â                pageLength: 10,
Â                order: [[0, 'asc']]
Â            });
Â        }

Â        // ğŸ”„ Fungsi Filter
Â        document.getElementById('filterBulan').addEventListener('change', function() {
Â            const selectedPeriode = this.value;
Â 
Â            // Hapus semua chart lama
Â            Chart.getChart('chartProduksi')?.destroy();
Â            Chart.getChart('chartHarga')?.destroy();
Â            Chart.getChart('chartPenjualanPie')?.destroy();
Â            Chart.getChart('chartRendemen')?.destroy();

Â            if (selectedPeriode === 'Semua') {
Â                currentData = rawData;
Â            } else {
Â                currentData = rawData.filter(item => item.periode === selectedPeriode);
Â            }

Â            // Inisialisasi ulang
Â            updateKPIs(currentData);
Â            initDataTable(currentData);
Â            initCharts(currentData);
Â        });

Â        // â¬‡ï¸ Fungsi Unduh Data (CSV)
Â        function unduhData() {
Â            const dataToDownload = currentData.map(item => ({
Â                Periode: item.periode,
Â                Blok: item.blok,
Â                Area_Ha: item.area,
Â                Produksi_TBS_Ton: item.tbs,
Â                Penjualan_CPO_Kg: item.cpoJual,
Â                Harga_CPO_Rp_Kg: item.hargaCPO,
Â                OER: item.oer
Â            }));

Â            if (dataToDownload.length === 0) {
Â                alert("Tidak ada data untuk diunduh.");
Â                return;
Â            }

Â            const header = Object.keys(dataToDownload[0]).join(',');
Â            const rows = dataToDownload.map(row => Object.values(row).join(','));
Â            const csv = [header, ...rows].join('\n');

Â            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
Â            const link = document.createElement('a');
Â            link.href = URL.createObjectURL(blob);
Â            link.download = 'data_kelapa_sawit_' + document.getElementById('filterBulan').value + '.csv';
Â            document.body.appendChild(link);
Â            link.click();
Â            document.body.removeChild(link);
Â        }

Â        // ğŸš€ Inisialisasi Aplikasi Saat Dokumen Siap
Â        $(document).ready(function() {
Â            updateKPIs(rawData);
Â            initDataTable(rawData);
Â            initCharts(rawData);
Â        });

Â    </script>
</body>
</html>